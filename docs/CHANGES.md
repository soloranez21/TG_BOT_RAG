# üìù –°–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞

## –î–∞—Ç–∞: 2025-12-27

---

## üéØ –¶–µ–ª—å

–î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞ –∏ –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–∏—á–∏–Ω, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –æ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

## ‚úÖ –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. **process_manager.py** - –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –î–æ–±–∞–≤–ª–µ–Ω–æ:
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ spawn
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É—Ç–∏ –∫ —Å–∫—Ä–∏–ø—Ç—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ Python executable
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ —á–µ—Ä–µ–∑ 0.5 —Å–µ–∫ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
- ‚úÖ –ó–∞—Ö–≤–∞—Ç –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ STDOUT/STDERR –µ—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å —É–º–∏—Ä–∞–µ—Ç —Å—Ä–∞–∑—É
- ‚úÖ –ü—Ä–µ—Ñ–∏–∫—Å `[SPAWN]` –¥–ª—è –≤—Å–µ—Ö –ª–æ–≥–æ–≤ spawn –ø—Ä–æ—Ü–µ—Å—Å–∞
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã `text=True` –∏ `bufsize=1` –¥–ª—è Popen

#### –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è:
```python
def get_bot_process_info(telegram_user_id: int) -> dict
```
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ—Ü–µ—Å—Å–µ:
- –°—Ç–∞—Ç—É—Å (running/terminated/not_found)
- PID
- Exit code
- STDOUT/STDERR

---

### 2. **handlers.py** - –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

#### –î–æ–±–∞–≤–ª–µ–Ω–æ:
- ‚úÖ –ò–º–ø–æ—Ä—Ç `get_bot_process_info`
- ‚úÖ –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ `/debug` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/help` —Å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º `/debug`

#### –ö–æ–º–∞–Ω–¥–∞ `/debug` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–∞
- PID (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω)
- Exit code (–µ—Å–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω)
- STDOUT (–ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤)
- STDERR (–ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤)

---

### 3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**

#### –°–æ–∑–¥–∞–Ω—ã —Ñ–∞–π–ª—ã:

1. **`docs/personal_bot_lifecycle.md`**
   - –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
   - –°—Ö–µ–º—ã –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–ø—É—Å–∫–∞
   - –¢–æ—á–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
   - –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

2. **`docs/testing_guide.md`**
   - –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
   - –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
   - –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

3. **`docs/CHANGES.md`** (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
   - –°–≤–æ–¥–∫–∞ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## üîç –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –í Telegram:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å**: `/status`
2. **–î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**: `/debug`
3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞**: `/restart`

### –í –ª–æ–≥–∞—Ö Master Bot:

–ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[SPAWN]`:

```
[SPAWN] Starting spawn process for user 123456789
[SPAWN] Personal bot path: c:\Users\...\main.py
[SPAWN] Command: python.exe ...
[SPAWN] ‚úÖ Spawned personal bot (PID: 12345)
[SPAWN] Process is alive and running
```

–ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å —É–º–∏—Ä–∞–µ—Ç:

```
[SPAWN] ‚ùå Process died immediately! Exit code: 1
[SPAWN] STDOUT: ...
[SPAWN] STDERR: ...
```

---

## üß™ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Master Bot
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/debug` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
5. –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ –≤ STDERR, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –∏—Ö

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```
Master Bot –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
    ‚Üì
[SPAWN] Starting spawn process
    ‚Üì
[SPAWN] Personal bot path: ...
    ‚Üì
[SPAWN] Command: ...
    ‚Üì
subprocess.Popen()
    ‚Üì
[SPAWN] ‚úÖ Spawned (PID: ...)
    ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 0.5 —Å–µ–∫
    ‚îú‚îÄ –ñ–∏–≤ ‚Üí [SPAWN] Process is alive
    ‚îî‚îÄ –ú–µ—Ä—Ç–≤ ‚Üí [SPAWN] ‚ùå Process died
                ‚îî‚îÄ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ STDOUT/STDERR
```

---

## üêõ –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|---------|
| `ModuleNotFoundError` | –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | `pip install -r requirements.txt` |
| `Unauthorized` | –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ –ë–î |
| `Connection refused` | Qdrant –Ω–µ –∑–∞–ø—É—â–µ–Ω | `docker-compose up -d` |
| `Invalid API key` | –ù–µ–≤–µ—Ä–Ω—ã–π OpenAI –∫–ª—é—á | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á |
| `Process died immediately` | –†–∞–∑–ª–∏—á–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ STDERR –≤ `/debug` |

---

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. `src/master_bot/process_manager.py`
2. `src/master_bot/handlers.py`
3. `docs/personal_bot_lifecycle.md` (–Ω–æ–≤—ã–π)
4. `docs/testing_guide.md` (–Ω–æ–≤—ã–π)
5. `docs/CHANGES.md` (–Ω–æ–≤—ã–π)
